<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>VoiceBridge â€“ Speech Translator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:      #0a0a0f;
      --surface: #111118;
      --surface2:#1a1a26;
      --border:  rgba(255,255,255,0.07);
      --accent:  #7c6aff;
      --accent2: #ff6a9e;
      --green:   #4fffb0;
      --text:    #e8e8f0;
      --muted:   #666680;
      --glow:    rgba(124,106,255,0.35);
    }
    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
    html, body { min-height:100vh; }
    body {
      width:100%; max-width:700px; margin:0 auto;
      background:var(--bg); color:var(--text);
      font-family:'Syne', sans-serif;
      overflow-x:hidden; padding-bottom:40px;
    }
    body::before {
      content:''; position:fixed; top:-50%; left:-50%;
      width:200%; height:200%; z-index:0; pointer-events:none;
      background:
        radial-gradient(ellipse at 30% 20%, rgba(124,106,255,0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 80%, rgba(255,106,158,0.06) 0%, transparent 50%);
      animation: bgPulse 8s ease-in-out infinite alternate;
    }
    @keyframes bgPulse {
      0%   { transform: scale(1) rotate(0deg); }
      100% { transform: scale(1.1) rotate(3deg); }
    }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .header {
      display:flex; align-items:center; justify-content:space-between;
      padding:16px 20px; border-bottom:1px solid var(--border);
      position:relative; z-index:1;
    }
    .logo { display:flex; align-items:center; gap:10px; }
    .logo-icon {
      width:36px; height:36px; border-radius:10px;
      background:linear-gradient(135deg, var(--accent), var(--accent2));
      display:flex; align-items:center; justify-content:center;
      font-size:18px; box-shadow:0 0 20px var(--glow); flex-shrink:0;
    }
    .logo-text {
      font-size:20px; font-weight:800; letter-spacing:-0.5px;
      background:linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    .status-badge {
      font-family:'DM Mono', monospace; font-size:10px;
      padding:3px 10px; border-radius:20px;
      border:1px solid var(--border); color:var(--muted);
      letter-spacing:1.5px; text-transform:uppercase; transition:all .3s;
    }
    .status-badge.active {
      border-color:var(--green); color:var(--green);
      box-shadow:0 0 12px rgba(79,255,176,.25);
      animation:statusBlink 2s ease-in-out infinite;
    }
    @keyframes statusBlink { 0%,100%{opacity:1} 50%{opacity:.55} }

    /* â”€â”€ Panels â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .panel {
      margin:12px 16px; background:var(--surface);
      border:1px solid var(--border); border-radius:14px;
      overflow:hidden; position:relative; z-index:1;
    }
    .panel-header {
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 14px; background:var(--surface2);
      border-bottom:1px solid var(--border);
    }
    .panel-label {
      font-size:10px; font-weight:700; letter-spacing:2px;
      text-transform:uppercase; color:var(--muted);
    }
    .lang-selector { display:flex; align-items:center; gap:6px; flex-wrap:wrap; }

    .detected-badge {
      font-family:'DM Mono', monospace; font-size:10px; color:var(--green);
      background:rgba(79,255,176,.1); padding:2px 8px; border-radius:4px;
      border:1px solid rgba(79,255,176,.2);
    }
    .auto-detect-toggle {
      display:flex; align-items:center; gap:5px; font-size:10px;
      color:var(--muted); cursor:pointer; user-select:none;
    }
    .toggle-switch {
      width:28px; height:15px; background:var(--border);
      border-radius:8px; position:relative; transition:background .2s; flex-shrink:0;
    }
    .toggle-switch.on { background:var(--accent); }
    .toggle-switch::after {
      content:''; position:absolute; width:11px; height:11px;
      background:#fff; border-radius:50%; top:2px; left:2px; transition:transform .2s;
    }
    .toggle-switch.on::after { transform:translateX(13px); }

    .lang-select {
      background:var(--bg); border:1px solid var(--border); color:var(--text);
      font-family:'DM Mono', monospace; font-size:11px; padding:4px 8px;
      border-radius:6px; cursor:pointer; outline:none; transition:border-color .2s;
    }
    .lang-select:focus {
      border-color:var(--accent); box-shadow:0 0 0 2px rgba(124,106,255,.2);
    }
    .btn-copy {
      background:none; border:none; color:var(--muted);
      cursor:pointer; font-size:14px; padding:2px 5px;
      border-radius:4px; transition:color .2s; line-height:1;
    }
    .btn-copy:hover { color:var(--accent); }

    /* â”€â”€ Text display â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .text-display {
      min-height:85px; max-height:115px; overflow-y:auto;
      padding:12px 14px; font-family:'DM Mono', monospace;
      font-size:13px; line-height:1.7; color:var(--text);
      scrollbar-width:thin; scrollbar-color:var(--border) transparent;
    }
    .text-display::-webkit-scrollbar { width:3px; }
    .text-display::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }
    .interim { color:var(--muted); font-style:italic; }

    /* â”€â”€ Confidence bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .confidence-bar {
      height:2px; background:var(--border);
      margin:0 14px 8px; border-radius:2px; overflow:hidden;
    }
    .confidence-fill {
      height:100%; width:0%;
      background:linear-gradient(90deg, var(--accent), var(--green));
      border-radius:2px; transition:width .5s ease;
    }

    /* â”€â”€ Waveform â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .waveform {
      display:flex; align-items:center; justify-content:center;
      gap:3px; height:38px; padding:0 14px 10px;
    }
    .wave-bar {
      width:3px; border-radius:2px; background:var(--accent);
      opacity:.35; transition:height .1s ease;
    }
    .wave-bar.active {
      opacity:1;
      animation:waveAnim var(--speed, .6s) ease-in-out infinite alternate;
    }
    @keyframes waveAnim { from{transform:scaleY(.15)} to{transform:scaleY(1)} }

    /* â”€â”€ Translate arrow â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .translate-arrow {
      display:flex; flex-direction:column; align-items:center;
      justify-content:center; gap:4px; padding:6px 0;
      position:relative; z-index:1;
    }
    .arrow-inner {
      width:34px; height:34px; background:var(--surface2);
      border:1px solid var(--border); border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      font-size:17px; color:var(--accent); transition:all .3s;
    }
    .arrow-inner.active {
      background:linear-gradient(135deg, var(--accent), var(--accent2));
      color:#fff; border-color:transparent;
      animation:spinIt 1s linear infinite;
      box-shadow:0 0 18px var(--glow);
    }
    @keyframes spinIt { from{transform:rotate(0)} to{transform:rotate(360deg)} }
    .arrow-label {
      font-size:9px; letter-spacing:2.5px; color:var(--muted);
      font-weight:700; text-transform:uppercase;
    }

    /* â”€â”€ Voice info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .voice-info {
      padding:4px 14px 10px;
      font-family:'DM Mono', monospace; font-size:10px; color:var(--muted);
    }

    /* â”€â”€ Mic banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .mic-banner {
      display:none; margin:4px 16px;
      background:rgba(124,106,255,.1); border:1px solid rgba(124,106,255,.35);
      border-radius:12px; padding:12px 16px;
      font-family:'DM Mono', monospace; font-size:12px;
      color:#a89fff; line-height:1.6; position:relative; z-index:1;
    }

    /* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .controls {
      display:flex; gap:10px; padding:14px 16px;
      position:relative; z-index:1;
    }
    .btn-mic {
      flex:1; display:flex; align-items:center; justify-content:center; gap:8px;
      padding:13px 16px; border-radius:12px; border:none; cursor:pointer;
      font-family:'Syne', sans-serif; font-size:14px; font-weight:700;
      letter-spacing:.5px; transition:all .2s; user-select:none;
    }
    .btn-mic:active { transform:scale(.96); }
    .btn-input {
      background:linear-gradient(135deg, var(--accent), #5a4de8);
      color:#fff; box-shadow:0 4px 20px rgba(124,106,255,.4);
    }
    .btn-input:hover { transform:translateY(-1px); box-shadow:0 6px 25px rgba(124,106,255,.55); }
    .btn-input.recording {
      background:linear-gradient(135deg, #ff4466, #cc2244);
      animation:recPulse 1.5s ease-in-out infinite;
    }
    @keyframes recPulse {
      0%,100%{box-shadow:0 4px 20px rgba(255,68,102,.4)}
      50%{box-shadow:0 4px 32px rgba(255,68,102,.75)}
    }
    .btn-output {
      background:linear-gradient(135deg, var(--accent2), #cc4477);
      color:#fff; box-shadow:0 4px 20px rgba(255,106,158,.35);
    }
    .btn-output:hover { transform:translateY(-1px); box-shadow:0 6px 25px rgba(255,106,158,.5); }
    .btn-output.speaking { animation:spkPulse 1s ease-in-out infinite; }
    @keyframes spkPulse {
      0%,100%{box-shadow:0 4px 20px rgba(255,106,158,.35)}
      50%{box-shadow:0 4px 30px rgba(255,106,158,.65)}
    }

    /* â”€â”€ Bottom bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .bottom-bar {
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 16px 14px; position:relative; z-index:1;
    }
    .stats { display:flex; gap:16px; }
    .stat { font-family:'DM Mono', monospace; font-size:10px; color:var(--muted); }
    .stat span { color:var(--text); font-weight:500; }

    /* â”€â”€ Clear All â€“ explicitly clickable â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #btnClear {
      display:inline-block;
      background:transparent;
      border:1px solid var(--border);
      color:var(--muted);
      font-family:'Syne', sans-serif;
      font-size:11px;
      font-weight:600;
      padding:7px 16px;
      border-radius:7px;
      cursor:pointer;
      outline:none;
      position:relative;
      z-index:50;
      pointer-events:auto;
      -webkit-user-select:none;
      user-select:none;
      transition:border-color .2s, color .2s, background .2s;
    }
    #btnClear:hover {
      border-color:var(--accent2);
      color:var(--accent2);
      background:rgba(255,106,158,.08);
    }
    #btnClear:active {
      transform:scale(.94);
      background:rgba(255,106,158,.16);
    }

    /* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #toast {
      position:fixed; bottom:16px; left:50%;
      transform:translateX(-50%) translateY(70px);
      background:var(--surface2); border:1px solid rgba(124,106,255,.45);
      color:var(--accent); font-family:'DM Mono', monospace; font-size:11px;
      padding:8px 16px; border-radius:8px; z-index:9999;
      white-space:nowrap; transition:transform .28s cubic-bezier(.34,1.56,.64,1);
    }
    #toast.show { transform:translateX(-50%) translateY(0); }
  </style>
</head>
<body>

  <!-- HEADER -->
  <div class="header">
      <span class="logo-text">VoiceBridge</span>
  </div>

  <!-- INPUT PANEL -->
  <div class="panel">
    <div class="panel-header">
      <span class="panel-label">Input Speech</span>
      <div class="lang-selector">
        <span id="detectedBadge" class="detected-badge" style="display:none">AUTO</span>
        <label class="auto-detect-toggle" id="autoDetectToggle">
          <div class="toggle-switch on" id="autoToggle"></div>
          Auto-detect
        </label>
        <select class="lang-select" id="inputLang" style="display:none"></select>
        <button type="button" class="btn-copy" id="copyInput" title="Copy input">â§‰</button>
      </div>
    </div>
    <div class="text-display" id="inputText">
      <span style="color:var(--muted);font-style:italic;font-size:13px">Click Record and start speaking...</span>
    </div>
    <div class="confidence-bar">
      <div class="confidence-fill" id="confidenceFill"></div>
    </div>
    <div class="waveform" id="waveform"></div>
  </div>

  <!-- TRANSLATE ARROW -->
  <div class="translate-arrow">
    <div class="arrow-inner" id="translateArrow">âŸ³</div>
    <span class="arrow-label">Translate</span>
  </div>

  <!-- OUTPUT PANEL -->
  <div class="panel">
    <div class="panel-header">
      <span class="panel-label">Translated Output</span>
      <div class="lang-selector">
        <select class="lang-select" id="outputLang"></select>
        <button type="button" class="btn-copy" id="copyOutput" title="Copy translation">â§‰</button>
      </div>
    </div>
    <div class="text-display" id="outputText"
         style="color:var(--muted);font-style:italic;font-family:'DM Mono',monospace;font-size:13px">
      Translation will appear here...
    </div>
    <div class="voice-info" id="voiceInfo"></div>
  </div>

  <!-- MIC BANNER -->
  <div class="mic-banner" id="micBanner">
    Microphone permission needed.<br>
    Click the <strong style="color:var(--text)">lock icon</strong> in the address bar
    â†’ <strong style="color:var(--text)">Microphone</strong> â†’ Allow â†’ Refresh.
  </div>

  <!-- CONTROLS -->
  <div class="controls">
    <button type="button" class="btn-mic btn-input" id="btnRecord">
      <span id="micIcon">ğŸ™ï¸</span>
      <span id="btnRecordLabel">Record</span>
    </button>
    <button type="button" class="btn-mic btn-output" id="btnSpeak" style="flex:0.7">
      <span id="speakIcon">ğŸ”Š</span>
      <span id="btnSpeakLabel">Speak</span>
    </button>
  </div>

  <!-- BOTTOM BAR -->
  <div class="bottom-bar">
    <div class="stats">
      <div class="stat">Words: <span id="wordCount">0</span></div>
      <div class="stat">Chars: <span id="charCount">0</span></div>
    </div>
    <button type="button" id="btnClear">Clear all</button>
  </div>

  <!-- TOAST -->
  <div id="toast"></div>

  <script src="popup.js"></script>
</body>
</html>
